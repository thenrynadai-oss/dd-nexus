<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vasteria Gate | Ficha</title>
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="sheet.css">

  <script>
  // Aplica o tema ANTES do paint (evita flicker/overlap).
  (function(){
    try{
      var t = localStorage.getItem('vasteria_theme') || 'coffee_caramel';
      var k = localStorage.getItem('vasteria_theme_kind') || 'minimal';
      // compat: 'caramel' antigo vira 'coffee_caramel'
      if(t === 'caramel') t = 'coffee_caramel';
      document.documentElement.setAttribute('data-theme', t);
      document.documentElement.setAttribute('data-theme-group', k);
    }catch(e){}
  })();
  </script>

  <link rel="stylesheet" href="cloud/collab.css" />
</head>
<body>

    <!-- Canvas de fundo animado (LOW POLY / Minimal) -->
    <canvas id="bg-canvas"></canvas>

    <!-- Modal de rolagem r√°pida -->
    <div id="quickroll-modal" class="roll-overlay" style="display:none;" onclick="this.style.display='none'">
        <div class="roll-card" onclick="event.stopPropagation()">
            <div class="d20-anim">
                <svg viewBox="0 0 100 100" class="d20-svg">
                    <polygon points="50,5 95,25 95,75 50,95 5,75 5,25" fill="transparent" stroke="currentColor" stroke-width="2"/>
                    <text x="50" y="60" text-anchor="middle" fill="currentColor" font-size="30" font-weight="bold" id="d20-number">20</text>
                </svg>
            </div>
            <h2 id="roll-result-val">20</h2>
            <p id="roll-result-detail">SUCESSO</p>
        </div>
    </div>

    <section id="sheet-section">

        <!-- HEADER -->
        <header class="sheet-header-floating">
            <button onclick="voltarParaHome()" class="btn-back-pro" title="Voltar ao HUB">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
            </button>

            <div class="hero-card-floating">
                <button id="btn-edit-character" class="btn-edit-hero" type="button" title="Editar personagem" aria-label="Editar personagem">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 20h9"/>
                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/>
                  </svg>
                </button>
                <div class="hero-img-box" id="sheet-avatar" aria-label="Avatar do personagem"></div>
                <div class="hero-text-box">
                    <div class="top-row-info">
                        <div class="info-group big">
                            <label>PERSONAGEM</label>
                            <h1 id="display-name">---</h1>
                        </div>
                        <div class="info-group">
                            <label>JOGADOR</label>
                            <p id="display-player">---</p>
                        </div>
                        <div class="info-group">
                            <label>CAMPANHA</label>
                            <input id="c-campaign" class="input-header save-field" placeholder="...">
                        </div>
                    </div>
                    <div class="bottom-row-info">
                        <div class="info-group">
                            <label>ANTECEDENTE</label>
                            <input id="c-bg" class="input-header small save-field" placeholder="...">
                        </div>
                        <div class="info-group">
                            <label>TEND√äNCIA</label>
                            <input id="c-align" class="input-header small save-field" placeholder="...">
                        </div>
                        <div class="info-group">
                            <label>XP</label>
                            <input id="c-xp" class="input-header small save-field" placeholder="0">
                        </div>
                    </div>
                </div>
            </div>

        </header>

        <!-- TABS (NOVA BARRA SUPERIOR) -->
        <nav class="sheet-tabs-bar" id="sheet-tabs">
            <button class="tab-btn active" data-tab="tab1" type="button">‚öîÔ∏è Ficha</button>
            <button class="tab-btn" data-tab="tab2" type="button">üìú Hist√≥ria</button>
            <button class="tab-btn" data-tab="tab3" type="button">‚ú® Magias</button>
            <button class="tab-btn" data-tab="tab4" type="button">üìì Notas</button>
        </nav>

        <!-- CONTE√öDO -->
        <div class="sheet-body-container">
            <div id="tab1" class="page active">
                <div class="stats-floating-box">
                    <div class="stat-cell"><label>CLASSE</label><input id="c-class" class="clean-input save-field" placeholder="Classe"></div>
                    <div class="stat-cell border-left"><label>RA√áA</label><input id="c-race" class="clean-input save-field" placeholder="Ra√ßa"></div>
                    <div class="stat-cell border-left"><label>N√çVEL</label><input id="c-level" class="clean-input save-field" value="1" type="number"></div>
                    <div class="stat-cell border-left special-insp">
                        <label>INSPIRA√á√ÉO</label>
                        <input id="c-inspiration-val" class="clean-input save-field" placeholder="--" style="font-size:18px;">
                    </div>
                </div>

                <div class="main-grid">
                    <div class="col-left">
                        <div id="attr-container"></div>
                        <div class="block mini highlight"><label>B√îNUS PROF.</label><input id="c-prof" class="clean-input center save-field" value="+2"></div>

                        <div class="block list-block">
                            <label>SALVAGUARDAS</label>
                            <div id="saves-container"></div>
                        </div>

                        <div class="block list-block">
                            <label>PER√çCIAS</label>
                            <div id="skills-container"></div>
                        </div>
                    </div>

                    <div class="col-mid">
                        <div class="combat-grid-row">
                            <div class="combat-box"><label>DEFESA (CA)</label><input id="c-ca" class="save-field big-stat" placeholder="10"></div>
                            <div class="combat-box"><label>INICIATIVA</label><input id="c-ini" class="save-field big-stat" placeholder="+0"></div>
                            <div class="combat-box"><label>DESLOCAMENTO</label><input id="c-speed" class="save-field big-stat" placeholder="9m"></div>
                        </div>

                        <div class="block hp-block">
                            <label>PONTOS DE VIDA</label>
                            <div class="hp-row">
                                <input id="c-hp-cur" class="save-field" placeholder="Atual"><span class="divider">/</span><input id="c-hp-max" class="save-field" placeholder="M√°x">
                            </div>
                            <div class="hp-temp-row"><label>Temp:</label><input id="c-hp-temp" class="save-field"></div>
                            <div class="death-saves-container">
                                <div class="ds-row">
                                    <span>SUCESSO</span>
                                    <div class="ds-checks">
                                        <input type="checkbox" id="ds-s1" class="save-field vg-check">
                                        <input type="checkbox" id="ds-s2" class="save-field vg-check">
                                        <input type="checkbox" id="ds-s3" class="save-field vg-check">
                                    </div>
                                </div>
                                <div class="ds-row">
                                    <span>FALHA</span>
                                    <div class="ds-checks">
                                        <input type="checkbox" id="ds-f1" class="save-field vg-check">
                                        <input type="checkbox" id="ds-f2" class="save-field vg-check">
                                        <input type="checkbox" id="ds-f3" class="save-field vg-check">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="block grow attack-bg">
                            <label>ATAQUES & CONJURA√á√ÉO</label>
                            <div class="icon-bg sword-bg"></div>
                            <textarea id="c-atks" class="clean-area save-field full-height"></textarea>
                        </div>

                        <div class="block grow inv-bg">
                            <label>EQUIPAMENTO</label>
                            <div class="icon-bg bag-bg"></div>
                            <div class="inv-layout">
                                <div class="money-col">
                                    <div><label>PL</label><input id="m-pp" class="money-in save-field"></div>
                                    <div><label>PO</label><input id="m-gp" class="money-in save-field"></div>
                                    <div><label>PE</label><input id="m-ep" class="money-in save-field"></div>
                                    <div><label>PP</label><input id="m-sp" class="money-in save-field"></div>
                                    <div><label>PC</label><input id="m-cp" class="money-in save-field"></div>
                                </div>
                                <textarea id="c-equip" class="clean-area save-field full-height" style="flex:1"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="col-right">
                        <div class="block"><label>TRA√áOS</label><textarea id="c-traits" class="clean-area small save-field"></textarea></div>
                        <div class="block"><label>IDEAIS</label><textarea id="c-ideals" class="clean-area small save-field"></textarea></div>
                        <div class="block"><label>V√çNCULOS</label><textarea id="c-bonds" class="clean-area small save-field"></textarea></div>
                        <div class="block"><label>DEFEITOS</label><textarea id="c-flaws" class="clean-area small save-field"></textarea></div>

                        <div class="block">
                            <label>PASSIVAS (SABEDORIA)</label>
                            <div class="passive-row"><span>Percep√ß√£o Passiva</span><input id="pas-perc" class="clean-input save-field" readonly></div>
                            <div class="passive-row"><span>Intui√ß√£o Passiva</span><input id="pas-ins" class="clean-input save-field" readonly></div>
                            <div class="passive-row"><span>Investiga√ß√£o Passiva</span><input id="pas-inv" class="clean-input save-field" readonly></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab2" class="page" style="display:none;">
                <div class="block full">
                    <textarea id="b-backstory" class="clean-area save-field" placeholder="Hist√≥ria..." style="height:600px"></textarea>
                </div>
            </div>

            <div id="tab3" class="page" style="display:none;">
                <div class="spellcasting-header">
                    <div class="spell-stat">
                        <label>HABILIDADE</label>
                        <select id="spell-ability" class="save-field spell-select" onchange="calcSpells()">
                            <option value="INT">INTELIG√äNCIA</option>
                            <option value="SAB">SABEDORIA</option>
                            <option value="CAR">CARISMA</option>
                        </select>
                    </div>
                    <div class="spell-stat"><label>CD MAGIA</label><div id="spell-dc" class="spell-val-display">10</div></div>
                    <div class="spell-stat"><label>B√îNUS ATAQUE</label><div id="spell-atk" class="spell-val-display">+2</div></div>
                </div>
                <div class="spells-grid-layout" id="spells-area"></div>
            </div>

            <div id="tab4" class="page" style="display:none;">
                <div class="block full">
                    <textarea id="d-notes" class="clean-area save-field" placeholder="Anota√ß√µes..." style="height:600px"></textarea>
                </div>
            </div>
        </div>
    </section>



    <!-- MODAL: editar personagem (igual ao estilo do HUB) -->
    <div id="modal-edit-character" class="modal-overlay" style="display:none;">
      <div class="modal-card panel-skin" role="dialog" aria-modal="true" aria-label="Editar personagem">
        <div class="modal-head">
          <h3>Editar personagem</h3>
          <button class="icon-btn" id="btn-close-edit-character" title="Fechar">‚úï</button>
        </div>

        <div class="field">
          <label>Nome do personagem</label>
          <input id="edit-char-name" placeholder="Nome" />
        </div>

        <div class="field">
          <label>Nome do jogador</label>
          <input id="edit-char-player" placeholder="Ex: Dani..." />
        </div>

        <div class="field">
          <label>Foto do personagem</label>
          <div class="edit-photo-row">
            <div class="edit-photo-preview" id="edit-char-preview" aria-label="Preview da foto"></div>
            <div class="edit-photo-actions">
              <button id="btn-edit-char-pick" class="btn-ghost" type="button">Escolher foto</button>
              <button id="btn-edit-char-remove" class="btn-ghost" type="button">Remover foto</button>
            </div>
          </div>
          <input type="file" id="edit-char-file" accept="image/*" hidden />
        </div>

        <div class="row-btn">
          <button id="btn-edit-char-cancel" class="btn-ghost" type="button">Cancelar</button>
          <button id="btn-edit-char-save" class="btn-blue" type="button">Salvar</button>
        </div>
      </div>
    </div>

    <!-- Bot√£o √öNICO de temas (o modal √© gerado em themes.js) -->
    <button class="dock-trigger-large open-themes" data-action="open-themes" title="Temas">üé®</button>

    <script src="themes.js"></script>
    <script src="bg.js"></script>
    <script src="auth.js"></script>
    <script src="firebase.config.js"></script>
    <script src="cloud/vgcloud.js"></script>
    <script src="cloud/sheet_bootstrap.js"></script>
    <script src="sheet.js"></script>
    <script src="cloud/collab.js"></script>
</body>
</html>
